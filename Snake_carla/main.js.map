{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["var canvas: HTMLCanvasElement;\nvar context: CanvasRenderingContext2D;\n\n// mail an b.kuhstoss@web.de\n// game variables\nvar score = 0;\nvar num_fruit_on_board = 0;\nvar fruit_coord = {\n    x:200,\n    y:200\n}\n\nvar special_fruit_there = false;\nvar special_fruit_coord = {\n    x: 0, y:  0\n}\nvar special_fruit_countdown = 0;\n\ntype Point = {x: number, y: number }\nvar middle = {\n    x: 400,\n    y: 400\n}\nvar r = 100;\nvar r_pos = r;\nvar v_r = 100; // pixels per second\nvar hue = 0;\n\nvar player_radius = 30\nvar segment_length = 15;\nvar dir = {\n    x: 0,\n    y: 0\n}\nvar tail: Point[] = [];\nvar last_eaten = 100;\n\n\n//\nvar death = false;\nvar highscore = 0\nvar last_scores : number[] = [];\n\n// system variables\nvar last_tick_t = 0;\nvar width: number;\nvar height: number;\nvar keyStates: Set<string> = new Set();\n\n\n//var logo = new Image();\n//logo.src = \"logo.png\";\n\n/* class Fruit {\n    constructor(x,y,i) {\n        \n    }\n} */\n\nfunction draw() {\n    context.resetTransform();\n    context.clearRect(0, 0, width, height);\n\n    // draw polygon/path\n/*     context.translate(middle.x, middle.y);\n    context.rotate(hue / 360 * 2 * Math.PI);\n    context.beginPath();\n    context.moveTo(0, -r);\n    context.lineTo(r_pos, -r_pos);\n    context.lineTo(r, 0);\n    context.lineTo(r_pos, r_pos);\n    context.lineTo(0, r);\n    context.lineTo(-r_pos, r_pos);\n    context.lineTo(-r, 0);\n    context.lineTo(-r_pos, -r_pos);\n    context.fill(); */\n\n\n\n    // before translate\n    \n    // draw fruit\n    if (num_fruit_on_board > 0){\n        context.font = \"50pt sans-serif\"; \n        context.textAlign = 'center';\n        context.fillText(`\uD83C\uDF4E`, fruit_coord.x, fruit_coord.y)\n    }\n\n    // draw fruit\n    if (special_fruit_there == true){\n        context.font = \"50pt sans-serif\"; \n        context.textAlign = 'center';\n        context.fillText(`\uD83C\uDF4C`, special_fruit_coord.x, special_fruit_coord.y)\n    }\n\n\n    // draw tail\n    let hue_ = hue\n    for(let element of tail){\n        context.fillStyle = `hsl(${hue_}, 50%, 50%)`\n        hue_ = (hue_ + 1) % 360;\n        context.beginPath();\n        context.arc(element.x,element.y,player_radius,0,2*Math.PI);\n        context.fill();\n    }\n\n    // draw circle\n    context.fillStyle = `hsl(${hue}, 50%, 50%)`\n    context.translate(middle.x, middle.y);\n    context.beginPath();\n    context.arc(0,0,player_radius,0,2*Math.PI)\n    context.fill();\n\n    // context.drawImage(logo, 100, 100);\n    context.fillStyle = `black`\n    context.font = \"10pt sans-serif\"; \n    context.textAlign = 'center';\n    if(last_eaten < 30){\n        context.fillText(\"^____^\", 0, 10)\n    }\n    else{\n        context.fillText(\"0____0\", 0, 10)\n    }\n\n\n\n    context.resetTransform();\n    // draw score\n    context.fillStyle = `purple`\n    context.font = \"18pt sans-serif\"; \n    context.textAlign = 'left';\n    context.fillText(`Score: ${score}`, width * 0.85, height * 0.1)\n    context.fillText(`Highscore: ${highscore}`,  width * 0.85, height * 0.16)\n    context.fillText(`Last scores:`, width * 0.85, height * 0.27)\n    let i = 1\n    for (let sc of last_scores){\n        context.fillText(`${sc}`, width * 0.85, height * (0.27+ i * 0.05))\n        i += 1\n        if (i > 10){\n            break;\n        }\n    }\n\n}   \n\nfunction update_direction(){\n\n/*     if (keyStates.size > 0){\n        dir.x = 0;\n        dir.y = 0;\n\n        if (keyStates.has(\"w\")){\n            dir.y +=  -1;\n        }\n        if (keyStates.has(\"a\")){\n            dir.x += -1;\n        }\n        if (keyStates.has(\"s\")){\n            dir.y += 1;\n        }\n        if (keyStates.has(\"d\")){\n            dir.x += 1;\n        }\n    } */\n\n    if (keyStates.has(\"w\")){\n        dir.x =  0;\n        dir.y =  -1;\n    }\n\n    if (keyStates.has(\"a\")){\n        dir.x = -1;\n        dir.y = 0;\n    }\n\n    if (keyStates.has(\"s\")){\n        dir.x = 0;\n        dir.y = 1;\n    }\n            \n    if (keyStates.has(\"d\")){\n        dir.x = 1;\n        dir.y = 0;\n    }\n\n}\n\nfunction update_position(dt:number): void{\n    // position\n    let speedup = (100 + score * 2 ) / 100\n    middle.x += 200 * dir.x * dt * speedup;\n    middle.y += 200 * dir.y * dt * speedup;\n\n    if (middle.x > width) {\n        middle.x = 0;\n    }\n\n    if (middle.x < 0) {\n        middle.x = width;\n    }\n    if (middle.y > height) {\n        middle.y = 0;\n    }\n    if (middle.y < 0) {\n        middle.y = height;\n    }\n    \n    let sth = {x : middle.x, y: middle.y};\n    tail.unshift(sth);\n    //}\n    while (tail.length > score * segment_length){\n        tail.pop()\n    }\n}\nfunction update_fruit(){\n    if (num_fruit_on_board == 0){\n        // create fruit\n        fruit_coord.x = (Math.random()*0.9 + 0.1)  * width;\n        fruit_coord.y = (Math.random()* 0.9 + 0.1) * height;\n        num_fruit_on_board = 1\n    }\n\n    // sometimes destroy fruit\n    if (Math.random()  < 0.001){\n        num_fruit_on_board = 0;\n    }\n\n    // can happen if resize\n    if (fruit_coord.x > height || fruit_coord.y > width){\n        num_fruit_on_board = 0;\n    }\n\n    if (special_fruit_countdown < 1){\n        special_fruit_there = false\n    }\n\n    if (Math.random() < 0.002 && special_fruit_there == false){\n        special_fruit_there = true\n        special_fruit_coord.x = (Math.random()*0.9 + 0.1)  * width;\n        special_fruit_coord.y = (Math.random()*0.9 + 0.1)  * height;\n        special_fruit_countdown = 300;\n    }\n\n    special_fruit_countdown += -1;\n}\n\nfunction update(dt: number) {\n\n    if (death){\n        last_scores.unshift(score);\n        if (score > highscore){\n            highscore = score;\n        }\n        score = 0;\n        dir.x = 0;\n        dir.y = 0;\n        middle.x = 400;\n        middle.y = 400;\n        death = false;\n    }\n\n    // SPIELER\n    // direction\n    update_direction();\n    // position\n    update_position(dt);\n    // color\n    hue = (hue + 1) % 360;\n    // player_radius = 30 + score * 5\n\n    // FRUIT\n    update_fruit()\n\n\n    if ((middle.x - fruit_coord.x)**2 + (middle.y + 20 - fruit_coord.y)**2 < (player_radius + 3) ** 2){\n        score += 1\n        num_fruit_on_board = 0\n        last_eaten = 0;\n    }\n    else if (special_fruit_there && (middle.x - special_fruit_coord.x)**2 + (middle.y + 20 - special_fruit_coord.y)**2 < (player_radius +3 ) ** 2){\n        score += 5\n        special_fruit_there = false;\n        last_eaten = 0;\n    }\n    else{\n        last_eaten += 1;\n    }\n\n    for(let i = 20; i < tail.length; i += 1){\n        let element = tail[i]\n        if ((middle.x - element.x)**2 + (middle.y - element.y)**2 < 2* (player_radius) ** 2){\n            death = true\n        }\n    } \n\n}\n\nfunction loop(t_ms: number) {\n    // calculate dt\n    let dt = t_ms - last_tick_t;\n    last_tick_t = t_ms;\n\n    update(dt / 1000); // to seconds\n    draw();\n\n    window.requestAnimationFrame(loop);\n}\n\nfunction resized() {\n    width = window.innerWidth;\n    height = window.innerHeight;\n    canvas.width = width;\n    canvas.height = height;\n}\n\nfunction key(e: KeyboardEvent) {\n    switch (e.type) {\n        case \"keydown\":\n            keyStates.add(e.key);\n            break;\n        case \"keyup\":\n            keyStates.delete(e.key);\n            break;\n        default:\n            console.warn(\"Wut?\");\n    }\n}\n\n/* \nfunction click(e: MouseEvent) {\n    middle.x = e.offsetX;\n    middle.y = e.offsetY;\n} */\n\nfunction main() {\n    canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\n    context = canvas.getContext(\"2d\")!;\n    window.addEventListener(\"keydown\", key);\n    window.addEventListener(\"keyup\", key);\n    window.addEventListener(\"resize\", resized);\n    //canvas.addEventListener(\"click\", click);\n    resized();\n    loop(performance.now());\n}\n\nmain();"],
  "mappings": "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",
  "names": []
}
