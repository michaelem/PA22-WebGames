(()=>{var P=(a=>(a[a.KING=0]="KING",a[a.QUEEN=1]="QUEEN",a[a.BISHOP=2]="BISHOP",a[a.KNIGHT=3]="KNIGHT",a[a.ROOK=4]="ROOK",a[a.PAWN=5]="PAWN",a[a.PAWN_PASSE=6]="PAWN_PASSE",a))(P||{}),p=(t=>(t[t.WHITE=0]="WHITE",t[t.BLACK=1]="BLACK",t))(p||{}),F=class{constructor(s,t,i,e,h){this.board=s,this.x=t,this.y=i,this.piece=e,this.color=h}canMoveTo(s){return this.piece==null||s!=this.color}fieldsToMoveTo(){let s=new Set;switch(this.piece){case 0:this.royalMoves(s,!0);break;case 1:this.royalMoves(s,!1);break;case 2:this.bishopMoves(s);break;case 4:this.rookMoves(s);break;case 3:this.knightMoves(s);case 5:case 6:this.pawnMoves(s);default:break}return s}addField(s,t,i){t!=null&&t.canMoveTo(s.turn)&&i.add(t)}pawnMoves(s){if(this.board.turn==0&&this.y>0||this.board.turn==1&&this.y<7){let i=this.getField(this.board.time,this.board.multiverse,this.x,this.y+(this.board.turn==0?-1:1));i!=null&&i.piece==null&&(this.addField(this.board,i,s),i!=null&&i.piece==null&&(this.board.turn==0&&this.y==6||this.board.turn==1&&this.y==1)&&(i=this.getField(this.board.time,this.board.multiverse,this.x,this.y+(this.board.turn==0?-2:2)),i!=null&&i.piece==null&&this.addField(this.board,i,s)))}let t=[-1,0,1];t.forEach(i=>{t.forEach(e=>{if(Math.abs(i)+Math.abs(e)>0){if(this.board.time+e*2<0||this.board.time+e*2>r.length-1)return;r[this.board.time+e*2].forEach(h=>{if(h==null)return;let l=this.getField(this.board.time+e*2,h.multiverse,this.x+i,this.y+(this.board.turn==0?-1:1));l!=null&&l.color!=this.board.turn&&l.piece!=null&&s.add(l)})}})}),(this.board.turn==0&&this.y==3||this.board.turn==1&&this.y==4)&&t.forEach(i=>{t.forEach(e=>{this.board.time+e*2<0||this.board.time+e*2>r.length-1||r[this.board.time+e*2].forEach(h=>{if(h==null)return;let l=this.getField(this.board.time+e*2,h.multiverse,this.x+i,this.y);console.log(l),l!=null&&l.color!=this.board.turn&&l.piece==6&&(console.log("passe"),l=this.getField(this.board.time+e*2,h.multiverse,this.x+i,this.y+(this.board.turn==0?-1:1)),l!=null&&l.piece==null&&s.add(l))})})})}knightMoves(s){let t=[-1,0,1];t.forEach(i=>{t.forEach(e=>{t.forEach(h=>{if(h==0&&Math.abs(i)+Math.abs(e)==2){let l=this.getField(this.board.time,this.board.multiverse,this.x+i*2,this.y+e);this.addField(this.board,l,s),l=this.getField(this.board.time,this.board.multiverse,this.x+i,this.y+e*2),this.addField(this.board,l,s)}else if(e==0&&Math.abs(h)+Math.abs(i)==2){let l=this.getField(this.board.time+h*2,this.board.multiverse,this.x+i*2,this.y);this.addField(this.board,l,s),l=this.getField(this.board.time+h*4,this.board.multiverse,this.x+i,this.y),this.addField(this.board,l,s)}else if(i==0&&Math.abs(h)+Math.abs(e)==2){let l=this.getField(this.board.time+h*2,this.board.multiverse,this.x,this.y+e*2);this.addField(this.board,l,s),l=this.getField(this.board.time+h*4,this.board.multiverse,this.x,this.y+e),this.addField(this.board,l,s)}else if(Math.abs(i)+Math.abs(e)+Math.abs(h)==1){if(this.board.time+h*2<0||this.board.time+h*2>r.length-1||(r[this.board.time+h*2].forEach(l=>{if(l==null||l.multiverse==this.board.multiverse)return;let a=this.getField(this.board.time+h*2,l.multiverse,this.x+i,this.y+e);this.addField(this.board,a,s)}),this.board.time+h*4<0||this.board.time+h*4>r.length-1))return;r[this.board.time+h*4].forEach(l=>{if(l==null||l.multiverse==this.board.multiverse)return;let a=this.getField(this.board.time+h*4,l.multiverse,this.x+i*2,this.y+e*2);this.addField(this.board,a,s)})}})})})}royalMoves(s,t){let i=[-1,0,1];i.forEach(e=>{i.forEach(h=>{i.forEach(l=>{Math.abs(e)+Math.abs(h)+Math.abs(l)!=0&&(this.board.time+l*2<0||this.board.time+l*2>r.length-1||r[this.board.time+l*2].forEach(a=>{if(a==null)return;let d=l,n=e,f=h,c=this.getField(this.board.time+d*2,a.multiverse,this.x+n,this.y+f);for(;c!=null&&c.canMoveTo(this.board.turn);){if(s.add(c),d+=l,n+=e,f+=h,c=this.getField(this.board.time+d*2,a.multiverse,this.x+n,this.y+f),c!=null&&c.piece!=null){c.canMoveTo(this.board.turn)&&s.add(c);break}if(t)break}}))})})});for(let e=0;e<r[this.board.time].length;e++){if(e==this.board.multiverse)continue;let h=this.getField(this.board.time,e,this.x,this.y);h!=null&&h.canMoveTo(this.board.turn)&&s.add(h)}}rookMoves(s){let t=[-1,0,1];t.forEach(i=>{t.forEach(e=>{t.forEach(h=>{if(Math.abs(i)+Math.abs(e)+Math.abs(h)==1){let l=h,a=i,d=e,n=this.getField(this.board.time+l*2,this.board.multiverse,this.x+a,this.y+d);for(;n!=null&&n.canMoveTo(this.board.turn);)if(s.add(n),l+=h,a+=i,d+=e,n=this.getField(this.board.time+l*2,this.board.multiverse,this.x+a,this.y+d),n!=null&&n.piece!=null){n.canMoveTo(this.board.turn)&&s.add(n);break}}})})});for(let i=0;i<r[this.board.time].length;i++){if(i==this.board.multiverse)continue;let e=this.getField(this.board.time,i,this.x,this.y);e!=null&&e.canMoveTo(this.board.turn)&&s.add(e)}}bishopMoves(s){let t=[-1,0,1];t.forEach(i=>{t.forEach(e=>{t.forEach(h=>{if(Math.abs(i)+Math.abs(e)+Math.abs(h)==2){let l=h,a=i,d=e,n=this.getField(this.board.time+l*2,this.board.multiverse,this.x+a,this.y+d);for(;n!=null&&n.canMoveTo(this.board.turn);)if(s.add(n),l+=h,a+=i,d+=e,n=this.getField(this.board.time+l*2,this.board.multiverse,this.x+a,this.y+d),n!=null&&n.piece!=null){n.canMoveTo(this.board.turn)&&s.add(n);break}}else if(Math.abs(i)+Math.abs(e)+Math.abs(h)==1&&this.board.time+h<r.length&&this.board.time+h>=0)for(let l=0;l<r[this.board.time+h].length;l++){if(l==this.board.multiverse)continue;let a=this.getField(this.board.time+h*2,l,this.x+i,this.y+e);a!=null&&a.canMoveTo(this.board.turn)&&s.add(a)}})})})}click(){u==this?(u=null,b=new Set):this.piece!=null&&this.color==this.board.turn&&this.board.nextBoards.size==0?(u=this,b=this.fieldsToMoveTo()):b.has(this)&&u!=null?(this.makeMove(u,this),u=null,b=new Set):(u=null,b=new Set),M()}makeMove(s,t){let i=g(t.board);s.board!=t.board?g(s.board).fields[s.x][s.y].piece=null:i.fields[s.x][s.y].piece=null,s.piece==5&&Math.abs(t.y-s.y)==2&&(i.fields[t.x][t.y].piece=6,console.log("test"));let e=this.getField(t.board.time,t.board.multiverse,t.x,t.y+(s.board.turn==0?1:-1));s.piece==5&&e!=null&&e.color!=s.color&&e.piece==6?e.board.fields[e.x][e.y].piece=null:i.fields[t.x][t.y].piece=s.piece,i.fields[t.x][t.y].color=s.color}getField(s,t,i,e){return s<0||s>r.length-1||i<0||i>7||e<0||e>7||t>r[s].length-1||t<0||r[s][t]==null?null:r[s][t].fields[i][e]}},v=class{constructor(s,t,i){this.previousBoard=t,this.turn=0,t!=null&&(t.nextBoards.add(this),this.turn=t.turn==0?1:0),this.nextBoards=new Set,this.fields=[];for(let e=0;e<8;e++){let h=[];for(let l=0;l<8;l++)h.push(new F(this,e,l,null,0));this.fields.push(h)}if(t!=null)for(let e=0;e<8;e++)for(let h=0;h<8;h++)this.fields[e][h].piece=t.fields[e][h].piece,this.fields[e][h].piece==6&&(this.fields[e][h].piece=5),this.fields[e][h].color=t.fields[e][h].color;this.canvas=s,this.canvas.width=E,this.canvas.height=E,this.canvas.addEventListener("click",e=>{let h=Math.floor(8*e.offsetX/this.canvas.width),l=Math.floor(8*e.offsetY/this.canvas.height);this.fields[h][l].click()}),this.context=this.canvas.getContext("2d"),this.time=t==null?0:t.time+1,this.multiverse=i}drawBoard(){let s=this.canvas.width/8,t=this.canvas.height/8;for(let i=0;i<8;i++)for(let e=0;e<8;e++){let h=i%2^e%2;u==this.fields[i][e]?this.context.fillStyle="hsl(30,70%,40%)":b.has(this.fields[i][e])?this.context.fillStyle="hsl(50,80%,50%)":h==0?this.context.fillStyle="#94b840":this.context.fillStyle="#2e3b10",this.context.fillRect(i*s,e*t,s,t);let l=this.fields[i][e];l.piece!=null&&this.context.drawImage(m[(l.piece==6?5:l.piece)+"_"+l.color],i*s,e*t,s,t)}this.nextBoards.size>0&&(this.context.fillStyle=this.turn==0?"rgba(220,220,220,40%)":"rgba(50,50,50,40%)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height))}},E=300;function S(o){var s=[4,3,2,1,0,2,3,4];for(let t=0;t<8;t++){for(let i=0;i<8;i++)o.fields[t][i].piece=null,o.fields[t][i].color=i>3?0:1;o.fields[t][0].piece=s[t],o.fields[t][1].piece=5,o.fields[t][6].piece=5,o.fields[t][7].piece=s[t]}}var m={};Object.keys(P).forEach(o=>{Object.keys(p).forEach(s=>{var t=parseInt(o),i=parseInt(s);!isNaN(t)&&!isNaN(i)&&(m[t+"_"+i]=new Image,m[t+"_"+i].src="pieces/"+i+"_"+t+".svg")})});var C,r=[],u=null,b=new Set;function M(){r.forEach(o=>{o.forEach(s=>{s?.drawBoard()})})}function g(o){let s,t=document.createElement("canvas");t.classList.add("chessboard");let i=0;if(o.nextBoards.size==0)i=o.multiverse;else{i=o.multiverse+1;for(let l of r){l.splice(i,0,null);for(let a=i;a<l.length;a++)l[a]!=null&&(l[a].multiverse=a)}}let e=new v(t,o,i);if(r.length<e.time+1){let l=r.push([])-1;for(let a=0;a<r[0].length;a++)r[l].push(null)}r[e.time][e.multiverse]=e;let h=C.createTBody();C.replaceChildren(h);for(let l=0;l<r[0].length;l++){let a=h.insertRow();for(let d=0;d<r.length;d++){let n=a.insertCell();r[d][l]!=null&&n.appendChild(r[d][l].canvas)}}return e}function y(){C=document.getElementById("timeline");let o=document.getElementById("first-chessboard"),s=[];s.push(new v(o,null,0)),r.push(s),S(s[0]),window.onload=t=>{M()}}y();})();
//# sourceMappingURL=main.js.map
