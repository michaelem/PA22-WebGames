{
  "version": 3,
  "sources": ["../src/player.ts", "../src/level.ts", "../src/main.ts"],
  "sourcesContent": ["export default class Player {\n  name: string;\n  positionX: number;\n  positionY: number;\n  targetY: number;\n  movementTimer: number;\n  speed: number;\n  context: CanvasRenderingContext2D;\n  color: string;\n  trail: Point[];\n  upKeyCode: string;\n  downKeyCode: string;\n\n  constructor(name: string, color: string, context: CanvasRenderingContext2D, startY: number, upKeyCode: string, downKeyCode: string) {\n    this.name = name;\n    this.speed = 50;\n    this.positionX = 200;\n    this.positionY = startY;\n    this.targetY = startY;\n    this.movementTimer = 0;\n    this.context = context;\n    this.color = color;\n    this.upKeyCode = upKeyCode;\n    this.downKeyCode = downKeyCode;\n\n    this.trail = [{ x: 0, y: startY }];\n  }\n\n  maxedOutMovement(): boolean {\n    // return Math.abs(this.targetY - this.positionY) >= 1;\n    return this.movementTimer > 0;\n  }\n\n  moveUp() {\n    if (!this.maxedOutMovement()) {\n      this.movementTimer = 0.25;\n      this.targetY = this.targetY - 10;\n    }\n  }\n\n  moveDown() {\n    if (!this.maxedOutMovement()) {\n      this.movementTimer = 0.25;\n      this.targetY = this.targetY + 10;\n    }\n  }\n\n  update(dt: number) {\n    this.trail.push({ x: this.positionX, y: this.positionY });\n    this.positionX = this.positionX + this.speed * dt;\n    let speed: number;\n\n    if (Math.abs(this.targetY - this.positionY) > 0) {\n      speed = (this.speed - 30) * (Math.cos(this.movementTimer/0.25 * Math.PI) + 1)\n\n      if (this.targetY - this.positionY > 0) { \n        this.positionY = Math.min(this.targetY, this.positionY + speed * dt)\n      } else {\n        this.positionY = Math.max(this.targetY, this.positionY - speed * dt)\n      }\n    } else {\n      speed = this.speed;\n    }\n\n    this.positionX = this.positionX + speed * dt;\n\n    if (this.movementTimer > 0) {\n      this.movementTimer = this.movementTimer - dt;\n    }\n  }\n\n  draw(viewPosition: number) {\n    const ctx = this.context;\n    ctx.resetTransform();\n\n    this.drawTrail(viewPosition);\n  }\n\n  drawTrail(viewPosition: number) {\n    this.cutTrail(viewPosition);\n\n    const ctx = this.context;\n\n    ctx.beginPath();\n    ctx.lineWidth = 2;\n    ctx.moveTo(this.trail[0].x - viewPosition, this.trail[0].y);\n\n    for (let point of this.trail) {\n      ctx.lineTo(point.x - viewPosition, Math.round(point.y));\n    }\n\n    ctx.strokeStyle = this.color;\n    ctx.stroke();\n  }\n\n  cutTrail(viewPosition: number) {\n    this.trail = this.trail.filter((point) => point.x >= viewPosition - 200);\n  }\n}\n\ninterface Point {\n  x: number;\n  y: number;\n}\n", "export default class Level {\n  context: CanvasRenderingContext2D;\n  end: number = 4300;\n  squares: Square[] = [\n    { x: 0, y: 0, size: 50 },\n    { x: 0, y: 400, size: 50 },\n    { x: 200, y: 400, size: 50 },\n    { x: 200, y: 0, size: 50 },\n    { x: 400, y: 400, size: 50 },\n    { x: 400, y: 0, size: 50 },\n    { x: 600, y: 400, size: 50 },\n    { x: 600, y: 0, size: 50 },\n    { x: 800, y: 400, size: 50 },\n    { x: 800, y: 0, size: 50 },\n    { x: 1000, y: 400, size: 50 },\n    { x: 1000, y: 0, size: 50 },\n    { x: 1200, y: 400, size: 50 },\n    { x: 1200, y: 0, size: 50 },\n    { x: 1400, y: 400, size: 50 },\n    { x: 1400, y: 0, size: 50 },\n    { x: 1600, y: 400, size: 50 },\n    { x: 1600, y: 0, size: 50 },\n    { x: 1620, y: 200, size: 50 },\n    { x: 1800, y: 400, size: 50 },\n    { x: 1800, y: 0, size: 50 },\n    { x: 2000, y: 400, size: 50 },\n    { x: 2000, y: 0, size: 50 },\n    { x: 2200, y: 0, size: 50 },\n    { x: 2200, y: 400, size: 50 },\n    { x: 2400, y: 0, size: 100 },\n    { x: 2400, y: 400, size: 100 },\n    { x: 2600, y: 200, size: 50 },\n    { x: 2600, y: 0, size: 100 },\n    { x: 2600, y: 400, size: 100 },\n    { x: 2750, y: 320, size: 80 },\n    { x: 2750, y: 200, size: 80 },\n    { x: 2750, y: 80, size: 80 },\n    { x: 2900, y: 400, size: 100 },\n    { x: 2900, y: 200, size: 100 },\n    { x: 2900, y: 0, size: 100 },\n    { x: 3300, y: 0, size: 350 },\n    { x: 3300, y: 400, size: 350 },\n    { x: 3800, y: 200, size: 150 },\n    { x: 3800, y: 0, size: 150 },\n    { x: 3800, y: 400, size: 150 },\n  ];\n\n  constructor(context: CanvasRenderingContext2D) {\n    this.context = context;\n  }\n\n  collide(x: number, y: number): boolean {\n    for (let square of this.squares) {\n      const squareX = square.x - square.size / 2;\n\n      if (x >= squareX && x <= squareX + square.size) {\n        const squareY = square.y - square.size / 2;\n\n        if (y >= squareY && y <= squareY + square.size) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  finish(x: number) {\n    return x >= this.end;\n  }\n\n  draw(viewPosition: number) {\n    const ctx = this.context;\n    for (let square of this.squares) {\n      const x = square.x - square.size / 2 - viewPosition;\n      const y = square.y - square.size / 2;\n      ctx.strokeStyle = \"white\";\n      ctx.strokeRect(x, y, square.size, square.size);\n    }\n\n    if (viewPosition < 2500) {\n      ctx.font = \"30px sans-serif\";\n      ctx.textAlign = \"left\";\n\n      ctx.fillStyle = \"green\";\n      ctx.fillText(\"Left is green\", 400 - viewPosition, 300);\n      ctx.fillText(\"Use 'w' and 's' to move\", 800 - viewPosition, 300);\n\n      ctx.fillStyle = \"orange\";\n      ctx.fillText(\"Right is orange\", 400 - viewPosition, 130);\n      ctx.fillText(\"Use 'up' and 'down' to move\", 800 - viewPosition, 130);\n\n      ctx.fillStyle = \"grey\";\n      ctx.fillText(`avoid the squares =>`, 1300 - viewPosition, 210);\n\n      ctx.fillStyle = \"grey\";\n      ctx.fillText(`get to finish first!`, 1900 - viewPosition, 210);\n\n      ctx.beginPath();\n      ctx.moveTo(2400 - viewPosition, 50);\n      ctx.lineTo(2400 - viewPosition, 350);\n      ctx.strokeStyle = \"grey\";\n      ctx.stroke()\n    }\n    ctx.beginPath();\n    ctx.moveTo(4300 - viewPosition, 0);\n    ctx.lineTo(4300 - viewPosition, 400);\n    ctx.strokeStyle = \"grey\";\n    ctx.stroke()\n  }\n}\n\ninterface Square {\n  x: number;\n  y: number;\n  size: number;\n}\n", "import Player from \"./player\"\nimport Level from \"./level\"\n\nvar canvas: HTMLCanvasElement;\nvar context: CanvasRenderingContext2D;\n\n// game variables\nvar players: Player[];\n\nvar viewPosition: number;\nvar level: Level\nvar lost = false;\nvar looser: string;\nvar won = false;\nvar winner: string;\n\n// system variables\nvar last_tick_t = 0;\nvar width: number;\nvar height: number;\n\nfunction draw() {\n  if (lost) {\n    context.fillStyle = \"red\";\n    context.fillRect(0, 0, width, height);\n\n    context.font = \"30px sans-serif\";\n    context.textAlign = 'center';\n    context.fillStyle = \"black\";\n    context.fillText(`\uD83D\uDE48 ${looser} lost`, 200, 200)\n    return;\n  }\n\n  if (won) {\n    context.fillStyle = \"green\";\n    context.fillRect(0, 0, width, height);\n\n    context.font = \"30px sans-serif\";\n    context.textAlign = 'center';\n    context.fillStyle = \"black\";\n    context.fillText(`\uD83D\uDE80 ${winner} won`, 200, 200)\n    return;\n  }\n\n  context.resetTransform();\n  context.clearRect(0, 0, width, height);\n  context.fillStyle = \"black\";\n  context.fillRect(0, 0, width, height);\n\n  for (let player of players) {\n    player.draw(viewPosition);\n  }\n  level.draw(viewPosition);\n}\n\nfunction update(dt: number) {\n  if (lost) {\n    return;\n  }\n\n  if (won) {\n    return;\n  }\n\n  for (let player of players) {\n    player.update(dt);\n  }\n\n  // Center viewport on average player position:\n  const averagePosition = players.reduce((total, next) => total + next.positionX, 0) / players.length;\n  viewPosition = averagePosition - width / 2;\n\n  for (let player of players) {\n    \n    if (level.collide(player.positionX, player.positionY)) {\n      lost = true;\n      looser = player.name;\n    }\n  }\n\n  for (let player of players) {\n    if (level.finish(player.positionX)) {\n      won = true;\n      winner = player.name;   \n    }\n  }\n}\n\nfunction loop(t_ms: number) {\n  // calculate dt\n  let dt = t_ms - last_tick_t;\n  last_tick_t = t_ms;\n\n  update(dt / 1000); // to seconds\n  draw();\n\n  window.requestAnimationFrame(loop);\n}\n\nfunction resized() {\n  width = window.innerWidth;\n  height = window.innerHeight;\n  if (width > height) {\n    canvas.width = height;\n    canvas.height = height;\n  } else {\n    canvas.width = width;\n    canvas.height = width;\n  }\n}\n\nfunction keyDownListner(event: KeyboardEvent) {\n  for (let player of players) {\n    if (event.code == player.upKeyCode) {\n      player.moveUp();\n    }\n    if (event.code == player.downKeyCode) {\n      player.moveDown();\n    }\n  }\n}\n\nfunction main() {\n  canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\n  width = canvas.width;\n  height = canvas.height;\n\n  viewPosition = width / 2;\n\n  context = canvas.getContext(\"2d\")!;\n  window.addEventListener(\"keydown\", keyDownListner);\n  // window.addEventListener(\"resize\", resized);\n  // resized();\n\n\n  players = [\n    new Player(\"right player\", \"orange\", context, 190, \"ArrowUp\", \"ArrowDown\"),\n    new Player(\"left player\", \"green\", context, 210, \"KeyW\", \"KeyS\")\n  ]\n  level = new Level(context);\n\n  loop(performance.now());\n}\n\nmain();\n"],
  "mappings": "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",
  "names": []
}
